!function(e){function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}var t={};n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=2)}([function(e,n){e.exports=require("express")},function(e,n,t){"use strict";var o=t(6),s=t(7),r=new s("dongnao_chat",o.username,o.password,{host:"192.168.0.4"});r.authenticate().then(function(){console.log("Connection has been established successfully.")}).catch(function(e){console.error("Unable to connect to the database:",e)});var i=r.define("user",{username:s.STRING,nickname:s.STRING,password:s.STRING,logo:s.STRING}),d=r.define("post",{title:s.STRING,content:s.STRING,image:s.STRING});d.belongsTo(i);var u=r.define("comment",{content:s.STRING});u.belongsTo(i),u.belongsTo(d);var a=r.define("star",{});a.belongsTo(i),a.belongsTo(d);var c=r.define("reply",{content:s.STRING});c.belongsTo(u);var f=r.define("request",{content:s.STRING,response:s.BOOLEAN,read:s.BOOLEAN});f.belongsTo(i,{as:"from"}),f.belongsTo(i,{as:"to"});var l=r.define("relation",{});i.belongsToMany(i,{as:"friend",through:l}),e.exports={User:i,Post:d,Comment:u,Star:a,Reply:c,Request:f,Relation:l,connect:r}},function(e,n,t){"use strict";var o=t(0),s=t(3),r=t(4),i=o();i.set("json spaces",4),i.use(r({urlencoded:!1})),i.use(r.json());var d=t(5),u=t(8),a=t(9);i.get("/",function(e,n){n.send("hello world")}),i.use(s()),i.use("/user",d),i.use("/post",u),i.use("/comment",a),i.listen(3e3)},function(e,n){e.exports=require("cors")},function(e,n){e.exports=require("body-parser")},function(e,n,t){"use strict";var o=t(1),s=o.User,r=o.Post,i=o.Relation,d=o.connect,u=t(0),a=u.Router();a.get("/",function(e,n){var t=e.query.offset,o=e.query.limit;t&&o?s.findAll({offset:parseInt(t),limit:parseInt(o)}).then(function(e){n.send(e)}):s.findAll().then(function(e){n.send(e)})}),a.get("/:id",function(e,n){s.findById(e.params.id).then(function(e){n.send(e)})}),a.get("/:id/post",function(e,n){d.query("select * from posts where userId = ?;",{model:r,replacements:[e.params.id]}).then(function(e){n.send(e)})}),a.get("/:id/friend",function(e,n){d.query("SELECT * \n        FROM users \n        WHERE \n        id IN (SELECT userId FROM relations WHERE friendId = ?) \n        OR \n        id IN (SELECT friendId FROM relations WHERE userId = ?);",{model:o.User,replacements:[e.params.id,e.params.id]}).then(function(e){n.send(e)})}),a.get("/:id/detail",function(e,n){s.findById(e.params.id).then(function(t){d.query("select * from posts where userId = ?;",{model:r,replacements:[e.params.id]}).then(function(s){t.dataValues.posts=s,d.query("SELECT * \n                    FROM users \n                    WHERE \n                    id IN (SELECT userId FROM relations WHERE friendId = ?) \n                    OR \n                    id IN (SELECT friendId FROM relations WHERE userId = ?);",{model:o.User,replacements:[e.params.id,e.params.id]}).then(function(e){t.dataValues.friends=e,n.send(t)})})})}),a.post("/:id/post",function(e,n){r.create({userId:e.params.id,title:e.body.title,content:e.body.content}).then(function(e){n.send(e)})}),a.delete("/:id/post",function(e,n){var t=e.body.postId.split(",");r.destroy({where:{id:{$or:t}}}).then(function(e){n.send(e)})}),a.put("/:id/post",function(e,n){r.findById(e.body.postId).then(function(t){t&&t.update({title:e.body.title,content:e.body.content}).then(function(e){n.send(e)})})}),a.post("/:id/friend",function(e,n){d.query("INSERT INTO \n        relations (createdAt, updatedAt, userId, friendId) \n        VALUES (NOW(), NOW(), ?, ?)",{replacements:[e.params.id,e.body.friendId]}).then(function(e){n.send(e)})}),a.delete("/:id/friend",function(e,n){var t=e.body.friendId.split(",");i.destroy({where:{$or:[{userId:e.params.id,friendId:{$in:t}},{userId:{$in:t},friendId:e.params.id}]}}).then(function(e){console.log(e),n.send(e)})}),e.exports=a},function(e,n,t){"use strict";e.exports={username:"root",password:"1234abcd"}},function(e,n){e.exports=require("sequelize")},function(e,n,t){"use strict";var o=t(1),s=o.Post,r=o.connect,i=t(0),d=i.Router();d.get("/",function(e,n){var t=e.query.offset,o=e.query.limit;t&&o?s.findAll({offset:parseInt(t),limit:parseInt(o)}).then(function(e){n.send(users)}):s.findAll().then(function(e){n.send(post)})}),d.get("/detail",function(e,n){r.query("select * from posts join users where posts.userId = users.id",{model:s}).then(function(e,t){n.send(e)})}),e.exports=d},function(e,n,t){"use strict";var o=t(1),s=o.Comment,r=(o.connect,t(0)),i=r.Router();i.get("/",function(e,n){var t=e.query.offset,o=e.query.limit;t&&o?s.findAll({offset:parseInt(t),limit:parseInt(o)}).then(function(e){n.send(e)}):s.findAll().then(function(e){n.send(e)})}),e.exports=i}]);